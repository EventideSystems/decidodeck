<div class="tab-pane active" id="checklist-items-tab">
  <div class="box box-solid">
    <div class="box-header with-border">
      <h3 class="box-title">Initative Characteristics</h3>
      <div class="pull-right">
        <%= link_to 'Scorecard Details', scorecard_path(@initiative.scorecard), class: 'btn btn-primary pull-right' %> 
      </div>
    </div>
    <!-- /.box-header -->
    <div class="box-body">
      <div class="box-group" id="accordion">
        <% FocusAreaGroup.order(:position).each do |focus_area_group| %>
          <div class="panel box box-primary">
            <div class="box-header with-border">
              <h4 class="box-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapsable-<%= focus_area_group.id %>">
                  <%= focus_area_group.name %>
                  <%- if focus_area_group.video_tutorial.present? %>
                    <%= 
                      link_to(video_tutorial_path(focus_area_group.video_tutorial), class: 'remote-link') do 
                        safe_join([content_tag(:i, '', class: "fa fa-youtube-play")])
                      end
                    %>
                  <%- end %>
                </a>
              </h4>
            </div>
            <div id="collapsable-<%= focus_area_group.id %>" class="panel-collapse collapse <%= "in" if focus_area_group == FocusAreaGroup.order(:position).first %> ">
              <% focus_area_group.focus_areas.order(:position).each do |focus_area| %>
                <div class="box-body">
                  <h3 class="box-title">
                    <%= focus_area.name %>
                    <%- if focus_area.video_tutorial.present? %>
                      <%= 
                        link_to(video_tutorial_path(focus_area.video_tutorial), class: 'remote-link') do 
                          safe_join([content_tag(:i, '', class: "fa fa-youtube-play")])
                        end
                      %>
                    <%- end %>
                  </h3>
                  <% checklist_items = @grouped_checklist_items.to_a.find_all { |ci| ci.characteristic.focus_area.id == focus_area.id } %>
                  <ul class="checklist-items">
                    <% checklist_items.each do |checklist_item| %>
                      <li>
                        <label>
                          <%= check_box_tag "checklist_item[#{checklist_item.id}]",
                            true, checklist_item.checked,
                            class: 'characteristic-checkbox', data: { id: checklist_item.id, initiative_id: checklist_item.initiative_id }
                          %>
                          
                          <span class="characteristic-name<%= " commented" if !checklist_item.comment.blank? %>"><%= checklist_item.characteristic.name %></span>
                          <%= link_to('#characteristic_comment', class: 'characteristic-comment', data: { id: checklist_item.id, initiative_id: checklist_item.initiative_id, toggle: "tooltip", placement: "top", title: "Add comment" }) do
                            safe_join([content_tag(:i, '', class: "fa fa-comments-o")])
                          end %>
                          <%- if checklist_item.characteristic.video_tutorial.present? %>
                            <%= 
                              link_to(video_tutorial_path(checklist_item.characteristic.video_tutorial), class: 'remote-link') do 
                                safe_join([content_tag(:i, '', class: "fa fa-youtube-play")])
                              end
                            %>
                          <%- end %>
                        </label>
                        <div class="box box-solid" style="display: none" id="characteristic-comment-form-<%=checklist_item.id%>">
                           <%= simple_form_for [checklist_item.initiative, checklist_item], html: { class: 'form-horizontal' }, remote: true, format: :json do |f|   %>
                             <%= f.input  :comment, label: false %>
                             <%= f.button :submit, "Save Comments", class: 'btn-checklist-comment-save', data: { id: checklist_item.id } %>
                             <button class="btn btn-default btn-checklist-comment-cancel" data-id="<%=checklist_item.id%>">Cancel</button>
                           <% end %>
                        </div>
                      </li>
                    <% end %>
                  </ul>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>  
  </div>
</div>