<div class="tab-pane active" id="checklist-items-tab">
  <div class="container">
    <div class="row tab-content-header p-3">
      <div class="col-sm">
        <div class="float-left pt-1">
          <h3>Initiative Characteristics</h3>
        </div>
        <div class="float-right">
          <%= link_to "#{Scorecard.model_name.human} Details", transition_card_path(@initiative.scorecard), class: 'btn btn-primary float-right' %> 
        </div>
      </div>
    </div>
    <!-- /.box-header -->
    <div class="box-body">
      <div class="box-group" id="accordion">
        <% FocusAreaGroup.order(:position).each do |focus_area_group| %>
          <div class="initiative-characteristics-container">
            <div class="focus-area-group-container">
              <h4 class="focus-area-group-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapsable-<%= focus_area_group.id %>">
                  <%= focus_area_group.name %>
                  <%- if focus_area_group.video_tutorial.present? %>
                    <%= 
                      link_to(
                        video_tutorial_path(focus_area_group.video_tutorial), 
                        class: 'video-tutorial-wrapper',
                          data: { 
                            video_tutorial_link: video_tutorial_path(focus_area_group.video_tutorial), 
                            video_tutorial_title: focus_area_group.video_tutorial.name 
                          } 
                      ) do 
                        safe_join([content_tag(:i, '', class: "fa fa-youtube-play")])
                      end
                    %>
                  <%- end %>
                </a>
              </h4>
            </div>
            <div id="collapsable-<%= focus_area_group.id %>" class="panel-collapse collapse <%= "show" if focus_area_group == FocusAreaGroup.order(:position).first %> ">
              <% focus_area_group.focus_areas.order(:position).each do |focus_area| %>
                <div class="box-body">
                  <h3 class="focus-area">
                    <%= focus_area.name %>
                    <%- if focus_area.video_tutorial.present? %>
                      <%= 
                        link_to(
                          video_tutorial_path(focus_area.video_tutorial), 
                          class: 'video-tutorial-wrapper',
                          data: { 
                            video_tutorial_link: video_tutorial_path(focus_area.video_tutorial), 
                            video_tutorial_title: focus_area.video_tutorial.name 
                          } 
                        ) do 
                          safe_join([content_tag(:i, '', class: "fa fa-youtube-play")])
                        end
                      %>
                    <%- end %>
                  </h3>
                  <% checklist_items = @grouped_checklist_items.to_a.find_all { |ci| ci.characteristic.focus_area.id == focus_area.id } %>
                  <ul class="checklist-items">
                    <% checklist_items.each do |checklist_item| %>
                      <div data-controller="comments">
                        <li>
                          <label>
                            <%= 
                              check_box_tag "checklist_item[#{checklist_item.id}]",
                                true, checklist_item.checked,
                                class: 'characteristic-checkbox', 
                                data: { 
                                  id: checklist_item.id, 
                                  initiative_id: checklist_item.initiative_id,
                                  comments_target: "checklistItem"
                                }
                            %>
                            
                            <span class="characteristic-name <%= current_comment_status_style(checklist_item) %>" data-comments-target="characteristic">
                              <%= checklist_item.characteristic.name %>
                            </span>
                            <%= link_to(
                              '#characteristic_comment', 
                              class: 'characteristic-comment', 
                              data: {
                                action: "comments#open",
                                id: checklist_item.id, 
                                initiative_id: checklist_item.initiative_id, 
                                toggle: "tooltip",
                                placement: "top", 
                                title: "Edit comments" 
                              }
                            ) do
                              safe_join([content_tag(:i, '', class: "fa fa-comments-o")])
                            end %>
                            <%- if checklist_item.characteristic.video_tutorial.present? %>
                              <%= 
                                link_to(
                                  video_tutorial_path(checklist_item.characteristic.video_tutorial), 
                                  class: 'video-tutorial-wrapper',
                                  data: { 
                                    video_tutorial_link: video_tutorial_path(checklist_item.characteristic.video_tutorial), 
                                    video_tutorial_title: checklist_item.characteristic.video_tutorial.name 
                                  } 
                                ) do 
                                  safe_join([content_tag(:i, '', class: "fa fa-youtube-play")])
                                end
                              %>
                            <%- end %>
                            <%- if checklist_item.characteristic.description.present? %>
                              <%= 
                                link_to(
                                  description_characteristic_path(checklist_item.characteristic), 
                                  class: 'remote-link description-characteristic-link',
                                  data: {
                                    toggle: "tooltip",
                                    placement: "top", 
                                    title: "More information" 
                                  }
                                ) do
                                  safe_join([content_tag(:i, '', class: "fas fa-info-circle")])
                                end
                              %>  
                            <%- end -%>
                          </label>
                          <%= render 'checklist_item_form', checklist_item: checklist_item, comment_statuses_collection: comment_statuses_collection %>
                        </li>
                      </div>
                    <%- end -%>
                  </ul>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>  
  </div>
</div>
