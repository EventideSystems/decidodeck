<h1>
  Stakeholders report
</h1>


<wkd-action-panel toggle-title="Report options" toggled="vm.openOptions">
  <form ng-submit="vm.generate()" class="form-horizontal">
    <div class="form-group clearfix">
      <label class="col-sm-4 control-label">
        Select wicked problem
      </label>

      <div class="col-sm-8">
        <ui-select ng-model="vm.report.problem" theme="bootstrap">
          <ui-select-match placeholder="-- Select a Wicked Problem --">
            {{ $select.selected.attributes.name }}
          </ui-select-match>
          <ui-select-choices repeat="problem in vm.problems | filter:{ attributes: { name: $select.search } } track by problem.id">
            <div ng-bind-html="problem.attributes.name | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>
      </div>
    </div>

    <div class="form-group clearfix">
      <label class="col-sm-4 control-label">
        Select community
      </label>

      <div class="col-sm-8">
        <ui-select on-select="vm.addCommunity()" ng-model="vm.report.community" theme="bootstrap">
          <ui-select-match placeholder="-- Select a Community --">
            {{ $select.selected.attributes.name }}
          </ui-select-match>
          <ui-select-choices repeat="community in vm.communities | filter:{ attributes: { name: $select.search } } track by community.id">
            <div ng-bind-html="community.attributes.name | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>
      </div>
    </div>

    <div class="form-group clearfix">
      <label class="col-sm-4 control-label" for="sector">
        Select community
      </label>

      <div class="col-sm-8">
        <input class="form-control" type="text" id="sector" placeholder="enter sector id" ng-model="vm.report.sector">
      </div>
    </div>

    <div class="col-sm-offset-4">
      <input type="submit" value="Generate" class="btn btn-primary">
      <input type="button" ng-click="vm.clear()" value="Clear" class="btn btn-default">
    </div>
  </form>
</wkd-action-panel>


<p ng-show="vm.loading"><i class="fa fa-spin fa-spinner"></i> Loading report..</p>


<table ng-show="vm.report.data" class="table table-striped table-hover" ts-wrapper>
  <thead>
    <tr>
      <td ts-criteria="attributes.name" ts-default>Name</td>
      <td ts-criteria="attributes.description">Description</td>
      <td ts-criteria="attributes.createdAt">Created at</td>
    </tr>
  </thead>
  <tbody>
    <tr ng-repeat="organisation in vm.report.data | filter:{attributes: { name: vm.filterText }}" ts-repeat>
      <td><a href ui-sref="^.view({ id: organisation.id })">{{ organisation.attributes.name }}</a></td>
      <td>{{ organisation.attributes.description | limitTo:75 }}<span ng-if="problem.attributes.description.length > 75">...</span></td>
      <td>{{ organisation.attributes.createdAt | date }}</td>
    </tr>
  </tbody>
</table>
